import { __assign, __decorate, __read } from "tslib";
import { ChangeDetectionStrategy, Component, } from '@angular/core';
import { combineLatest } from 'rxjs';
import { PaginationModel, Product, ProductInterestEntryRelation, ProductInterestSearchResult, ProductScope, ProductService, TranslationService, UserInterestsService, } from '@spartacus/core';
import { map, tap } from 'rxjs/operators';
var MyInterestsComponent = /** @class */ (function () {
    function MyInterestsComponent(productInterestService, translationService, productService) {
        this.productInterestService = productInterestService;
        this.translationService = translationService;
        this.productService = productService;
        this.DEFAULT_PAGE_SIZE = 10;
        this.sortMapping = {
            byNameAsc: 'name:asc',
            byNameDesc: 'name:desc',
        };
        this.sort = 'byNameAsc';
        this.sortOptions = [
            {
                code: 'byNameAsc',
                selected: false,
            },
            {
                code: 'byNameDesc',
                selected: false,
            },
        ];
    }
    MyInterestsComponent.prototype.ngOnInit = function () {
        var _this = this;
        this.interests$ = this.productInterestService
            .getAndLoadProductInterests(this.DEFAULT_PAGE_SIZE)
            .pipe(tap(function (interests) {
            return (_this.pagination = {
                currentPage: interests.pagination.page,
                pageSize: interests.pagination.count,
                totalPages: interests.pagination.totalPages,
                totalResults: interests.pagination.totalCount,
                sort: 'byNameAsc',
            });
        }), map(function (interest) { return (__assign(__assign({}, interest), { results: interest.results
                ? interest.results.map(function (result) { return (__assign(__assign({}, result), { product$: _this.getProduct(result) })); })
                : interest.results })); }));
        this.getInterestsloading$ = this.productInterestService.getProdutInterestsLoading();
        this.isRemoveDisabled$ = combineLatest([
            this.getInterestsloading$,
            this.productInterestService.getRemoveProdutInterestLoading(),
        ]).pipe(map(function (_a) {
            var _b = __read(_a, 2), getLoading = _b[0], removeLoading = _b[1];
            return getLoading || removeLoading;
        }));
        this.sortLabels = this.getSortLabels();
    };
    MyInterestsComponent.prototype.getSortLabels = function () {
        return combineLatest([
            this.translationService.translate('myInterests.sorting.byNameAsc'),
            this.translationService.translate('myInterests.sorting.byNameDesc'),
        ]).pipe(map(function (_a) {
            var _b = __read(_a, 2), asc = _b[0], desc = _b[1];
            return {
                byNameAsc: asc,
                byNameDesc: desc,
            };
        }));
    };
    MyInterestsComponent.prototype.getProduct = function (interest) {
        return this.productService.get(interest.product.code, ProductScope.DETAILS);
    };
    MyInterestsComponent.prototype.removeInterest = function (relation) {
        this.productInterestService.removeProdutInterest({
            product: relation.product,
            productInterestEntry: relation.productInterestEntry,
        });
    };
    MyInterestsComponent.prototype.sortChange = function (sort) {
        this.sort = sort;
        this.productInterestService.loadProductInterests(this.DEFAULT_PAGE_SIZE, 0, this.sortMapping[sort]);
    };
    MyInterestsComponent.prototype.pageChange = function (page) {
        this.productInterestService.loadProductInterests(this.DEFAULT_PAGE_SIZE, page, this.sortMapping[this.sort]);
    };
    MyInterestsComponent.prototype.ngOnDestroy = function () {
        this.productInterestService.clearProductInterests();
        this.productInterestService.resetRemoveInterestState();
    };
    MyInterestsComponent.ctorParameters = function () { return [
        { type: UserInterestsService },
        { type: TranslationService },
        { type: ProductService }
    ]; };
    MyInterestsComponent = __decorate([
        Component({
            selector: 'cx-my-interests',
            template: "<div *ngIf=\"interests$ | async as interests\" class=\"container\">\n  <div class=\"cx-product-interests-title h3\">\n    <h3>{{ 'myInterests.header' | cxTranslate }}</h3>\n  </div>\n  <div\n    class=\"cx-product-interests-body\"\n    *ngIf=\"!(getInterestsloading$ | async); else loading\"\n  >\n    <ng-container *ngIf=\"interests.pagination.totalCount > 0; else noInterest\">\n      <div class=\"cx-product-interests-sort top row\">\n        <div\n          class=\"cx-product-interests-form-group form-group col-sm-12 col-md-4 col-lg-4\"\n        >\n          <cx-sorting\n            [sortOptions]=\"sortOptions\"\n            [sortLabels]=\"sortLabels | async\"\n            (sortListEvent)=\"sortChange($event)\"\n            [selectedOption]=\"sort\"\n            placeholder=\"{{ 'myInterests.sortByMostRecent' | cxTranslate }}\"\n          >\n          </cx-sorting>\n        </div>\n        <div\n          class=\"cx-product-interests-pagination cx-product-interests-thead-mobile\"\n        >\n          <cx-pagination\n            [pagination]=\"pagination\"\n            (viewPageEvent)=\"pageChange($event)\"\n          ></cx-pagination>\n        </div>\n      </div>\n      <table class=\"table cx-product-interests-table\">\n        <thead class=\"cx-product-interests-thead-mobile\">\n          <th scope=\"col\">\n            {{ 'myInterests.item' | cxTranslate }}\n          </th>\n          <th scope=\"col\"></th>\n          <th scope=\"col\">\n            {{ 'myInterests.price' | cxTranslate }}\n          </th>\n          <th scope=\"col\">\n            {{ 'myInterests.notifications' | cxTranslate }}\n          </th>\n          <th scope=\"col\"></th>\n        </thead>\n        <tbody>\n          <tr\n            *ngFor=\"let interest of interests.results\"\n            class=\"cx-product-interests-product-item\"\n          >\n            <ng-container *ngIf=\"interest.product$ | async as product\">\n              <td>\n                <div class=\"cx-product-interests-label\">\n                  <a\n                    class=\"cx-product-interests-product-image-link\"\n                    tabindex=\"-1\"\n                    [routerLink]=\"\n                      { cxRoute: 'product', params: product } | cxUrl\n                    \"\n                  >\n                    <cx-media\n                      [container]=\"product.images?.PRIMARY\"\n                      format=\"thumbnail\"\n                    ></cx-media>\n                  </a>\n                </div>\n              </td>\n              <td>\n                <div class=\"cx-info col-10\">\n                  <div class=\"cx-info-container row \">\n                    <div>\n                      <div *ngIf=\"product.name\" class=\"cx-name\">\n                        <a\n                          class=\"cx-link cx-product-interests-product-code-link\"\n                          [routerLink]=\"\n                            { cxRoute: 'product', params: product } | cxUrl\n                          \"\n                        >\n                          {{ product.name }}\n                        </a>\n                      </div>\n                      <div *ngIf=\"product.code\" class=\"cx-code\">\n                        <span>{{\n                          'myInterests.productId'\n                            | cxTranslate: { code: product.code }\n                        }}</span>\n                      </div>\n\n                      <ng-container\n                        *ngFor=\"let baseOptions of product.baseOptions\"\n                      >\n                        <div\n                          *ngFor=\"\n                            let variant of baseOptions.selected\n                              ?.variantOptionQualifiers\n                          \"\n                          class=\"cx-property\"\n                        >\n                          <div\n                            class=\"cx-label cx-product-interests-variant-name\"\n                          >\n                            {{ variant.name }}\n                          </div>\n                          <div\n                            class=\"cx-value cx-product-interests-variant-value\"\n                          >\n                            {{ variant.value }}\n                          </div>\n                        </div>\n                      </ng-container>\n                      <div\n                        class=\"cx-property\"\n                        *ngIf=\"product.stock.stockLevelStatus === 'outOfStock'\"\n                      >\n                        <div\n                          class=\"cx-label cx-product-interests-product-stock\"\n                        >\n                          {{ 'myInterests.outOfStock' | cxTranslate }}\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </td>\n              <td>\n                <div class=\"cx-product-interests-product-price\">\n                  <div class=\"d-md-none cx-product-interests-label\">\n                    {{ 'myInterests.price' | cxTranslate }}\n                  </div>\n                  <span>{{ product.price.formattedValue }}</span>\n                </div>\n              </td>\n              <td>\n                <div class=\"cx-product-interests-subscriptions\">\n                  <div class=\"d-md-none cx-product-interests-label\">\n                    {{ 'myInterests.notifications' | cxTranslate }}\n                  </div>\n                  <div\n                    class=\"cx-product-interests-notification\"\n                    *ngFor=\"let interestEntry of interest.productInterestEntry\"\n                  >\n                    <span class=\"cx-product-interests-type\">\n                      {{\n                        'myInterests.' + interestEntry.interestType\n                          | cxTranslate\n                      }}\n                    </span>\n                    <span class=\"cx-product-interests-expiration-date\">\n                      {{\n                        'myInterests.expirationDate'\n                          | cxTranslate\n                            : {\n                                expirationDate:\n                                  interestEntry.expirationDate | date\n                              }\n                      }}\n                    </span>\n                  </div>\n                </div>\n              </td>\n              <td>\n                <div class=\"cx-actions cx-product-interests-remove-button\">\n                  <button\n                    type=\"button\"\n                    class=\"link cx-product-interests-remove-btn\"\n                    [disabled]=\"isRemoveDisabled$ | async\"\n                    (click)=\"removeInterest(interest)\"\n                  >\n                    {{ 'myInterests.remove' | cxTranslate }}\n                  </button>\n                </div>\n              </td>\n            </ng-container>\n          </tr>\n        </tbody>\n      </table>\n      <div class=\"cx-product-interests-sort bottom row\">\n        <div\n          class=\"cx-product-interests-form-group cx-product-interests-thead-mobile form-group col-sm-12 col-md-4 col-lg-4\"\n        >\n          <cx-sorting\n            [sortOptions]=\"sortOptions\"\n            [sortLabels]=\"sortLabels | async\"\n            (sortListEvent)=\"sortChange($event)\"\n            [selectedOption]=\"sort\"\n            placeholder=\"{{ 'myInterests.sortByMostRecent' | cxTranslate }}\"\n          >\n          </cx-sorting>\n        </div>\n        <div class=\"cx-product-interests-pagination\">\n          <cx-pagination\n            [pagination]=\"pagination\"\n            (viewPageEvent)=\"pageChange($event)\"\n          ></cx-pagination>\n        </div>\n      </div>\n    </ng-container>\n  </div>\n</div>\n<ng-template #noInterest>\n  <div class=\"cx-product-interests-message\">\n    {{ 'myInterests.noInterests' | cxTranslate }}\n  </div>\n</ng-template>\n<ng-template #loading>\n  <div class=\"cx-spinner\">\n    <cx-spinner></cx-spinner>\n  </div>\n</ng-template>\n",
            changeDetection: ChangeDetectionStrategy.OnPush
        })
    ], MyInterestsComponent);
    return MyInterestsComponent;
}());
export { MyInterestsComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibXktaW50ZXJlc3RzLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BzcGFydGFjdXMvc3RvcmVmcm9udC8iLCJzb3VyY2VzIjpbImNtcy1jb21wb25lbnRzL215YWNjb3VudC9teS1pbnRlcmVzdHMvbXktaW50ZXJlc3RzLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUNMLHVCQUF1QixFQUN2QixTQUFTLEdBR1YsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLGFBQWEsRUFBYyxNQUFNLE1BQU0sQ0FBQztBQUNqRCxPQUFPLEVBQ0wsZUFBZSxFQUNmLE9BQU8sRUFDUCw0QkFBNEIsRUFDNUIsMkJBQTJCLEVBQzNCLFlBQVksRUFDWixjQUFjLEVBQ2Qsa0JBQWtCLEVBQ2xCLG9CQUFvQixHQUNyQixNQUFNLGlCQUFpQixDQUFDO0FBQ3pCLE9BQU8sRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFhMUM7SUF5QkUsOEJBQ1Usc0JBQTRDLEVBQzVDLGtCQUFzQyxFQUN0QyxjQUE4QjtRQUY5QiwyQkFBc0IsR0FBdEIsc0JBQXNCLENBQXNCO1FBQzVDLHVCQUFrQixHQUFsQixrQkFBa0IsQ0FBb0I7UUFDdEMsbUJBQWMsR0FBZCxjQUFjLENBQWdCO1FBM0JoQyxzQkFBaUIsR0FBRyxFQUFFLENBQUM7UUFDdkIsZ0JBQVcsR0FBRztZQUNwQixTQUFTLEVBQUUsVUFBVTtZQUNyQixVQUFVLEVBQUUsV0FBVztTQUN4QixDQUFDO1FBRUYsU0FBSSxHQUFHLFdBQVcsQ0FBQztRQUNuQixnQkFBVyxHQUFHO1lBQ1o7Z0JBQ0UsSUFBSSxFQUFFLFdBQVc7Z0JBQ2pCLFFBQVEsRUFBRSxLQUFLO2FBQ2hCO1lBQ0Q7Z0JBQ0UsSUFBSSxFQUFFLFlBQVk7Z0JBQ2xCLFFBQVEsRUFBRSxLQUFLO2FBQ2hCO1NBQ0YsQ0FBQztJQVlDLENBQUM7SUFFSix1Q0FBUSxHQUFSO1FBQUEsaUJB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LENBQUM7SUFDSixDQUFDO0lBRUQseUNBQVUsR0FBVixVQUFXLElBQVk7UUFDckIsSUFBSSxDQUFDLHNCQUFzQixDQUFDLG9CQUFvQixDQUM5QyxJQUFJLENBQUMsaUJBQWlCLEVBQ3RCLElBQUksRUFDSixJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FDNUIsQ0FBQztJQUNKLENBQUM7SUFFRCwwQ0FBVyxHQUFYO1FBQ0UsSUFBSSxDQUFDLHNCQUFzQixDQUFDLHFCQUFxQixFQUFFLENBQUM7UUFDcEQsSUFBSSxDQUFDLHNCQUFzQixDQUFDLHdCQUF3QixFQUFFLENBQUM7SUFDekQsQ0FBQzs7Z0JBN0ZpQyxvQkFBb0I7Z0JBQ3hCLGtCQUFrQjtnQkFDdEIsY0FBYzs7SUE1QjdCLG9CQUFvQjtRQUxoQyxTQUFTLENBQUM7WUFDVCxRQUFRLEVBQUUsaUJBQWlCO1lBQzNCLG9oUUFBNEM7WUFDNUMsZUFBZSxFQUFFLHVCQUF1QixDQUFDLE1BQU07U0FDaEQsQ0FBQztPQUNXLG9CQUFvQixDQXdIaEM7SUFBRCwyQkFBQztDQUFBLEFBeEhELElBd0hDO1NBeEhZLG9CQUFvQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICBDb21wb25lbnQsXG4gIE9uRGVzdHJveSxcbiAgT25Jbml0LFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IGNvbWJpbmVMYXRlc3QsIE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7XG4gIFBhZ2luYXRpb25Nb2RlbCxcbiAgUHJvZHVjdCxcbiAgUHJvZHVjdEludGVyZXN0RW50cnlSZWxhdGlvbixcbiAgUHJvZHVjdEludGVyZXN0U2VhcmNoUmVzdWx0LFxuICBQcm9kdWN0U2NvcGUsXG4gIFByb2R1Y3RTZXJ2aWNlLFxuICBUcmFuc2xhdGlvblNlcnZpY2UsXG4gIFVzZXJJbnRlcmVzdHNTZXJ2aWNlLFxufSBmcm9tICdAc3BhcnRhY3VzL2NvcmUnO1xuaW1wb3J0IHsgbWFwLCB0YXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbmludGVyZmFjZSBQcm9kdWN0SW50ZXJlc3RTZWFyY2hSZXN1bHRVSSBleHRlbmRzIFByb2R1Y3RJbnRlcmVzdFNlYXJjaFJlc3VsdCB7XG4gIHJlc3VsdHM/OiAoUHJvZHVjdEludGVyZXN0RW50cnlSZWxhdGlvbiAmIHtcbiAgICBwcm9kdWN0JD86IE9ic2VydmFibGU8UHJvZHVjdD47XG4gIH0pW107XG59XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2N4LW15LWludGVyZXN0cycsXG4gIHRlbXBsYXRlVXJsOiAnLi9teS1pbnRlcmVzdHMuY29tcG9uZW50Lmh0bWwnLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbn0pXG5leHBvcnQgY2xhc3MgTXlJbnRlcmVzdHNDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSB7XG4gIHByaXZhdGUgREVGQVVMVF9QQUdFX1NJWkUgPSAxMDtcbiAgcHJpdmF0ZSBzb3J0TWFwcGluZyA9IHtcbiAgICBieU5hbWVBc2M6ICduYW1lOmFzYycsXG4gICAgYnlOYW1lRGVzYzogJ25hbWU6ZGVzYycsXG4gIH07XG5cbiAgc29ydCA9ICdieU5hbWVBc2MnO1xuICBzb3J0T3B0aW9ucyA9IFtcbiAgICB7XG4gICAgICBjb2RlOiAnYnlOYW1lQXNjJyxcbiAgICAgIHNlbGVjdGVkOiBmYWxzZSxcbiAgICB9LFxuICAgIHtcbiAgICAgIGNvZGU6ICdieU5hbWVEZXNjJyxcbiAgICAgIHNlbGVjdGVkOiBmYWxzZSxcbiAgICB9LFxuICBdO1xuICBwYWdpbmF0aW9uOiBQYWdpbmF0aW9uTW9kZWw7XG5cbiAgaW50ZXJlc3RzJDogT2JzZXJ2YWJsZTxQcm9kdWN0SW50ZXJlc3RTZWFyY2hSZXN1bHRVST47XG4gIGlzUmVtb3ZlRGlzYWJsZWQkOiBPYnNlcnZhYmxlPGJvb2xlYW4+O1xuICBnZXRJbnRlcmVzdHNsb2FkaW5nJDogT2JzZXJ2YWJsZTxib29sZWFuPjtcbiAgc29ydExhYmVsczogT2JzZXJ2YWJsZTx7IGJ5TmFtZUFzYzogc3RyaW5nOyBieU5hbWVEZXNjOiBzdHJpbmcgfT47XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBwcm9kdWN0SW50ZXJlc3RTZXJ2aWNlOiBVc2VySW50ZXJlc3RzU2VydmljZSxcbiAgICBwcml2YXRlIHRyYW5zbGF0aW9uU2VydmljZTogVHJhbnNsYXRpb25TZXJ2aWNlLFxuICAgIHByaXZhdGUgcHJvZHVjdFNlcnZpY2U6IFByb2R1Y3RTZXJ2aWNlXG4gICkge31cblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLmludGVyZXN0cyQgPSB0aGlzLnByb2R1Y3RJbnRlcmVzdFNlcnZpY2VcbiAgICAgIC5nZXRBbmRMb2FkUHJvZHVjdEludGVyZXN0cyh0aGlzLkRFRkFVTFRfUEFHRV9TSVpFKVxuICAgICAgLnBpcGUoXG4gICAgICAgIHRhcChcbiAgICAgICAgICBpbnRlcmVzdHMgPT5cbiAgICAgICAgICAgICh0aGlzLnBhZ2luYXRpb24gPSB7XG4gICAgICAgICAgICAgIGN1cnJlbnRQYWdlOiBpbnRlcmVzdHMucGFnaW5hdGlvbi5wYWdlLFxuICAgICAgICAgICAgICBwYWdlU2l6ZTogaW50ZXJlc3RzLnBhZ2luYXRpb24uY291bnQsXG4gICAgICAgICAgICAgIHRvdGFsUGFnZXM6IGludGVyZXN0cy5wYWdpbmF0aW9uLnRvdGFsUGFnZXMsXG4gICAgICAgICAgICAgIHRvdGFsUmVzdWx0czogaW50ZXJlc3RzLnBhZ2luYXRpb24udG90YWxDb3VudCxcbiAgICAgICAgICAgICAgc29ydDogJ2J5TmFtZUFzYycsXG4gICAgICAgICAgICB9KVxuICAgICAgICApLFxuICAgICAgICBtYXAoaW50ZXJlc3QgPT4gKHtcbiAgICAgICAgICAuLi5pbnRlcmVzdCxcbiAgICAgICAgICByZXN1bHRzOiBpbnRlcmVzdC5yZXN1bHRzXG4gICAgICAgICAgICA/IGludGVyZXN0LnJlc3VsdHMubWFwKHJlc3VsdCA9PiAoe1xuICAgICAgICAgICAgICAgIC4uLnJlc3VsdCxcbiAgICAgICAgICAgICAgICBwcm9kdWN0JDogdGhpcy5nZXRQcm9kdWN0KHJlc3VsdCksXG4gICAgICAgICAgICAgIH0pKVxuICAgICAgICAgICAgOiBpbnRlcmVzdC5yZXN1bHRzLFxuICAgICAgICB9KSlcbiAgICAgICk7XG5cbiAgICB0aGlzLmdldEludGVyZXN0c2xvYWRpbmckID0gdGhpcy5wcm9kdWN0SW50ZXJlc3RTZXJ2aWNlLmdldFByb2R1dEludGVyZXN0c0xvYWRpbmcoKTtcbiAgICB0aGlzLmlzUmVtb3ZlRGlzYWJsZWQkID0gY29tYmluZUxhdGVzdChbXG4gICAgICB0aGlzLmdldEludGVyZXN0c2xvYWRpbmckLFxuICAgICAgdGhpcy5wcm9kdWN0SW50ZXJlc3RTZXJ2aWNlLmdldFJlbW92ZVByb2R1dEludGVyZXN0TG9hZGluZygpLFxuICAgIF0pLnBpcGUobWFwKChbZ2V0TG9hZGluZywgcmVtb3ZlTG9hZGluZ10pID0+IGdldExvYWRpbmcgfHwgcmVtb3ZlTG9hZGluZykpO1xuXG4gICAgdGhpcy5zb3J0TGFiZWxzID0gdGhpcy5nZXRTb3J0TGFiZWxzKCk7XG4gIH1cblxuICBwcml2YXRlIGdldFNvcnRMYWJlbHMoKTogT2JzZXJ2YWJsZTx7XG4gICAgYnlOYW1lQXNjOiBzdHJpbmc7XG4gICAgYnlOYW1lRGVzYzogc3RyaW5nO1xuICB9PiB7XG4gICAgcmV0dXJuIGNvbWJpbmVMYXRlc3QoW1xuICAgICAgdGhpcy50cmFuc2xhdGlvblNlcnZpY2UudHJhbnNsYXRlKCdteUludGVyZXN0cy5zb3J0aW5nLmJ5TmFtZUFzYycpLFxuICAgICAgdGhpcy50cmFuc2xhdGlvblNlcnZpY2UudHJhbnNsYXRlKCdteUludGVyZXN0cy5zb3J0aW5nLmJ5TmFtZURlc2MnKSxcbiAgICBdKS5waXBlKFxuICAgICAgbWFwKChbYXNjLCBkZXNjXSkgPT4ge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGJ5TmFtZUFzYzogYXNjLFxuICAgICAgICAgIGJ5TmFtZURlc2M6IGRlc2MsXG4gICAgICAgIH07XG4gICAgICB9KVxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIGdldFByb2R1Y3QoXG4gICAgaW50ZXJlc3Q6IFByb2R1Y3RJbnRlcmVzdEVudHJ5UmVsYXRpb25cbiAgKTogT2JzZXJ2YWJsZTxQcm9kdWN0PiB7XG4gICAgcmV0dXJuIHRoaXMucHJvZHVjdFNlcnZpY2UuZ2V0KGludGVyZXN0LnByb2R1Y3QuY29kZSwgUHJvZHVjdFNjb3BlLkRFVEFJTFMpO1xuICB9XG5cbiAgcmVtb3ZlSW50ZXJlc3QoXG4gICAgcmVsYXRpb246IFByb2R1Y3RJbnRlcmVzdEVudHJ5UmVsYXRpb24gJiB7XG4gICAgICBwcm9kdWN0JD86IE9ic2VydmFibGU8UHJvZHVjdD47XG4gICAgfVxuICApOiB2b2lkIHtcbiAgICB0aGlzLnByb2R1Y3RJbnRlcmVzdFNlcnZpY2UucmVtb3ZlUHJvZHV0SW50ZXJlc3Qoe1xuICAgICAgcHJvZHVjdDogcmVsYXRpb24ucHJvZHVjdCxcbiAgICAgIHByb2R1Y3RJbnRlcmVzdEVudHJ5OiByZWxhdGlvbi5wcm9kdWN0SW50ZXJlc3RFbnRyeSxcbiAgICB9KTtcbiAgfVxuXG4gIHNvcnRDaGFuZ2Uoc29ydDogc3RyaW5nKTogdm9pZCB7XG4gICAgdGhpcy5zb3J0ID0gc29ydDtcbiAgICB0aGlzLnByb2R1Y3RJbnRlcmVzdFNlcnZpY2UubG9hZFByb2R1Y3RJbnRlcmVzdHMoXG4gICAgICB0aGlzLkRFRkFVTFRfUEFHRV9TSVpFLFxuICAgICAgMCxcbiAgICAgIHRoaXMuc29ydE1hcHBpbmdbc29ydF1cbiAgICApO1xuICB9XG5cbiAgcGFnZUNoYW5nZShwYWdlOiBudW1iZXIpOiB2b2lkIHtcbiAgICB0aGlzLnByb2R1Y3RJbnRlcmVzdFNlcnZpY2UubG9hZFByb2R1Y3RJbnRlcmVzdHMoXG4gICAgICB0aGlzLkRFRkFVTFRfUEFHRV9TSVpFLFxuICAgICAgcGFnZSxcbiAgICAgIHRoaXMuc29ydE1hcHBpbmdbdGhpcy5zb3J0XVxuICAgICk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICB0aGlzLnByb2R1Y3RJbnRlcmVzdFNlcnZpY2UuY2xlYXJQcm9kdWN0SW50ZXJlc3RzKCk7XG4gICAgdGhpcy5wcm9kdWN0SW50ZXJlc3RTZXJ2aWNlLnJlc2V0UmVtb3ZlSW50ZXJlc3RTdGF0ZSgpO1xuICB9XG59XG4iXX0=