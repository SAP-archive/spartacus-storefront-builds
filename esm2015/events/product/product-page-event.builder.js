import { __decorate } from "tslib";
import { Injectable } from '@angular/core';
import { createFrom, EventService, ProductSearchService, ProductService, } from '@spartacus/core';
import { EMPTY } from 'rxjs';
import { filter, map, skip, switchMap, take } from 'rxjs/operators';
import { PageVisitedEvent } from '../page/page.events';
import { CategoryPageResultsEvent, ProductDetailsPageEvent, SearchPageResultsEvent, } from './product-page.events';
import * as i0 from "@angular/core";
import * as i1 from "@spartacus/core";
let ProductPageEventBuilder = class ProductPageEventBuilder {
    constructor(eventService, productService, productSearchService) {
        this.eventService = eventService;
        this.productService = productService;
        this.productSearchService = productSearchService;
        this.register();
    }
    register() {
        this.eventService.register(SearchPageResultsEvent, this.buildSearchPageResultsEvent());
        this.eventService.register(ProductDetailsPageEvent, this.buildProductDetailsPageEvent());
        this.eventService.register(CategoryPageResultsEvent, this.buildCategoryResultsPageEvent());
    }
    buildProductDetailsPageEvent() {
        return this.eventService.get(PageVisitedEvent).pipe(filter((pageVisitedEvent) => pageVisitedEvent.semanticRoute === 'product'), map((pageVisitedEvent) => pageVisitedEvent.context.id), switchMap((productId) => this.productService.get(productId).pipe(filter((product) => Boolean(product)), take(1), map((product) => createFrom(ProductDetailsPageEvent, {
            categories: product.categories,
            code: product.code,
            name: product.name,
            price: product.price,
        })))));
    }
    buildCategoryResultsPageEvent() {
        const searchResults$ = this.productSearchService.getResults().pipe(
        // skipping the initial value, and preventing emission of the previous search state
        skip(1));
        const categoryPageVisitedEvent$ = this.eventService
            .get(PageVisitedEvent)
            .pipe(map((pageVisitedEvent) => ({
            isCategoryPage: pageVisitedEvent.semanticRoute === 'category',
            categoryCode: pageVisitedEvent.context.id,
        })));
        return categoryPageVisitedEvent$.pipe(switchMap((pageEvent) => {
            if (!pageEvent.isCategoryPage) {
                return EMPTY;
            }
            return searchResults$.pipe(map((searchResults) => ({
                categoryCode: pageEvent.categoryCode,
                categoryName: searchResults.breadcrumbs[0].facetValueName,
            })), map((categoryPage) => createFrom(CategoryPageResultsEvent, categoryPage)));
        }));
    }
    buildSearchPageResultsEvent() {
        const searchResults$ = this.productSearchService.getResults().pipe(
        // skipping the initial value, and preventing emission of the previous search state
        skip(1), map((searchResults) => ({
            searchTerm: searchResults.freeTextSearch,
            numberOfResults: searchResults.pagination.totalResults,
        })), map((searchPage) => createFrom(SearchPageResultsEvent, searchPage)));
        const searchPageVisitedEvent$ = this.eventService
            .get(PageVisitedEvent)
            .pipe(map((pageVisitedEvent) => pageVisitedEvent.semanticRoute === 'search'));
        return searchPageVisitedEvent$.pipe(switchMap((isSearchPage) => (isSearchPage ? searchResults$ : EMPTY)));
    }
};
ProductPageEventBuilder.ctorParameters = () => [
    { type: EventService },
    { type: ProductService },
    { type: ProductSearchService }
];
ProductPageEventBuilder.ɵprov = i0.ɵɵdefineInjectable({ factory: function ProductPageEventBuilder_Factory() { return new ProductPageEventBuilder(i0.ɵɵinject(i1.EventService), i0.ɵɵinject(i1.ProductService), i0.ɵɵinject(i1.ProductSearchService)); }, token: ProductPageEventBuilder, providedIn: "root" });
ProductPageEventBuilder = __decorate([
    Injectable({
        providedIn: 'root',
    })
], ProductPageEventBuilder);
export { ProductPageEventBuilder };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvZHVjdC1wYWdlLWV2ZW50LmJ1aWxkZXIuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9Ac3BhcnRhY3VzL3N0b3JlZnJvbnQvIiwic291cmNlcyI6WyJldmVudHMvcHJvZHVjdC9wcm9kdWN0LXBhZ2UtZXZlbnQuYnVpbGRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQ0wsVUFBVSxFQUNWLFlBQVksRUFDWixvQkFBb0IsRUFDcEIsY0FBYyxHQUNmLE1BQU0saUJBQWlCLENBQUM7QUFDekIsT0FBTyxFQUFFLEtBQUssRUFBYyxNQUFNLE1BQU0sQ0FBQztBQUN6QyxPQUFPLEVBQUUsTUFBTSxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3BFLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3ZELE9BQU8sRUFDTCx3QkFBd0IsRUFDeEIsdUJBQXVCLEVBQ3ZCLHNCQUFzQixHQUN2QixNQUFNLHVCQUF1QixDQUFDOzs7QUFLL0IsSUFBYSx1QkFBdUIsR0FBcEMsTUFBYSx1QkFBdUI7SUFDbEMsWUFDWSxZQUEwQixFQUMxQixjQUE4QixFQUM5QixvQkFBMEM7UUFGMUMsaUJBQVksR0FBWixZQUFZLENBQWM7UUFDMUIsbUJBQWMsR0FBZCxjQUFjLENBQWdCO1FBQzlCLHlCQUFvQixHQUFwQixvQkFBb0IsQ0FBc0I7UUFFcEQsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO0lBQ2xCLENBQUM7SUFFUyxRQUFRO1FBQ2hCLElBQUksQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUN4QixzQkFBc0IsRUFDdEIsSUFBSSxDQUFDLDJCQUEyQixFQUFFLENBQ25DLENBQUM7UUFDRixJQUFJLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FDeEIsdUJBQXVCLEVBQ3ZCLElBQUksQ0FBQyw0QkFB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QUFDLFVBQVUsRUFBRSxFQUFFLENBQUMsVUFBVSxDQUFDLHNCQUFzQixFQUFFLFVBQVUsQ0FBQyxDQUFDLENBQ3BFLENBQUM7UUFFRixNQUFNLHVCQUF1QixHQUFHLElBQUksQ0FBQyxZQUFZO2FBQzlDLEdBQUcsQ0FBQyxnQkFBZ0IsQ0FBQzthQUNyQixJQUFJLENBQ0gsR0FBRyxDQUFDLENBQUMsZ0JBQWdCLEVBQUUsRUFBRSxDQUFDLGdCQUFnQixDQUFDLGFBQWEsS0FBSyxRQUFRLENBQUMsQ0FDdkUsQ0FBQztRQUVKLE9BQU8sdUJBQXVCLENBQUMsSUFBSSxDQUNqQyxTQUFTLENBQUMsQ0FBQyxZQUFZLEVBQUUsRUFBRSxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQ3JFLENBQUM7SUFDSixDQUFDO0NBQ0YsQ0FBQTs7WUF4RzJCLFlBQVk7WUFDVixjQUFjO1lBQ1Isb0JBQW9COzs7QUFKM0MsdUJBQXVCO0lBSG5DLFVBQVUsQ0FBQztRQUNWLFVBQVUsRUFBRSxNQUFNO0tBQ25CLENBQUM7R0FDVyx1QkFBdUIsQ0EwR25DO1NBMUdZLHVCQUF1QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7XG4gIGNyZWF0ZUZyb20sXG4gIEV2ZW50U2VydmljZSxcbiAgUHJvZHVjdFNlYXJjaFNlcnZpY2UsXG4gIFByb2R1Y3RTZXJ2aWNlLFxufSBmcm9tICdAc3BhcnRhY3VzL2NvcmUnO1xuaW1wb3J0IHsgRU1QVFksIE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGZpbHRlciwgbWFwLCBza2lwLCBzd2l0Y2hNYXAsIHRha2UgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBQYWdlVmlzaXRlZEV2ZW50IH0gZnJvbSAnLi4vcGFnZS9wYWdlLmV2ZW50cyc7XG5pbXBvcnQge1xuICBDYXRlZ29yeVBhZ2VSZXN1bHRzRXZlbnQsXG4gIFByb2R1Y3REZXRhaWxzUGFnZUV2ZW50LFxuICBTZWFyY2hQYWdlUmVzdWx0c0V2ZW50LFxufSBmcm9tICcuL3Byb2R1Y3QtcGFnZS5ldmVudHMnO1xuXG5ASW5qZWN0YWJsZSh7XG4gIHByb3ZpZGVkSW46ICdyb290Jyxcbn0pXG5leHBvcnQgY2xhc3MgUHJvZHVjdFBhZ2VFdmVudEJ1aWxkZXIge1xuICBjb25zdHJ1Y3RvcihcbiAgICBwcm90ZWN0ZWQgZXZlbnRTZXJ2aWNlOiBFdmVudFNlcnZpY2UsXG4gICAgcHJvdGVjdGVkIHByb2R1Y3RTZXJ2aWNlOiBQcm9kdWN0U2VydmljZSxcbiAgICBwcm90ZWN0ZWQgcHJvZHVjdFNlYXJjaFNlcnZpY2U6IFByb2R1Y3RTZWFyY2hTZXJ2aWNlXG4gICkge1xuICAgIHRoaXMucmVnaXN0ZXIoKTtcbiAgfVxuXG4gIHByb3RlY3RlZCByZWdpc3RlcigpOiB2b2lkIHtcbiAgICB0aGlzLmV2ZW50U2VydmljZS5yZWdpc3RlcihcbiAgICAgIFNlYXJjaFBhZ2VSZXN1bHRzRXZlbnQsXG4gICAgICB0aGlzLmJ1aWxkU2VhcmNoUGFnZVJlc3VsdHNFdmVudCgpXG4gICAgKTtcbiAgICB0aGlzLmV2ZW50U2VydmljZS5yZWdpc3RlcihcbiAgICAgIFByb2R1Y3REZXRhaWxzUGFnZUV2ZW50LFxuICAgICAgdGhpcy5idWlsZFByb2R1Y3REZXRhaWxzUGFnZUV2ZW50KClcbiAgICApO1xuICAgIHRoaXMuZXZlbnRTZXJ2aWNlLnJlZ2lzdGVyKFxuICAgICAgQ2F0ZWdvcnlQYWdlUmVzdWx0c0V2ZW50LFxuICAgICAgdGhpcy5idWlsZENhdGVnb3J5UmVzdWx0c1BhZ2VFdmVudCgpXG4gICAgKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBidWlsZFByb2R1Y3REZXRhaWxzUGFnZUV2ZW50KCk6IE9ic2VydmFibGU8XG4gICAgUHJvZHVjdERldGFpbHNQYWdlRXZlbnRcbiAgPiB7XG4gICAgcmV0dXJuIHRoaXMuZXZlbnRTZXJ2aWNlLmdldChQYWdlVmlzaXRlZEV2ZW50KS5waXBlKFxuICAgICAgZmlsdGVyKFxuICAgICAgICAocGFnZVZpc2l0ZWRFdmVudCkgPT4gcGFnZVZpc2l0ZWRFdmVudC5zZW1hbnRpY1JvdXRlID09PSAncHJvZHVjdCdcbiAgICAgICksXG4gICAgICBtYXAoKHBhZ2VWaXNpdGVkRXZlbnQpID0+IHBhZ2VWaXNpdGVkRXZlbnQuY29udGV4dC5pZCksXG4gICAgICBzd2l0Y2hNYXAoKHByb2R1Y3RJZCkgPT5cbiAgICAgICAgdGhpcy5wcm9kdWN0U2VydmljZS5nZXQocHJvZHVjdElkKS5waXBlKFxuICAgICAgICAgIGZpbHRlcigocHJvZHVjdCkgPT4gQm9vbGVhbihwcm9kdWN0KSksXG4gICAgICAgICAgdGFrZSgxKSxcbiAgICAgICAgICBtYXAoKHByb2R1Y3QpID0+XG4gICAgICAgICAgICBjcmVhdGVGcm9tKFByb2R1Y3REZXRhaWxzUGFnZUV2ZW50LCB7XG4gICAgICAgICAgICAgIGNhdGVnb3JpZXM6IHByb2R1Y3QuY2F0ZWdvcmllcyxcbiAgICAgICAgICAgICAgY29kZTogcHJvZHVjdC5jb2RlLFxuICAgICAgICAgICAgICBuYW1lOiBwcm9kdWN0Lm5hbWUsXG4gICAgICAgICAgICAgIHByaWNlOiBwcm9kdWN0LnByaWNlLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICApXG4gICAgICAgIClcbiAgICAgIClcbiAgICApO1xuICB9XG5cbiAgcHJvdGVjdGVkIGJ1aWxkQ2F0ZWdvcnlSZXN1bHRzUGFnZUV2ZW50KCk6IE9ic2VydmFibGU8XG4gICAgQ2F0ZWdvcnlQYWdlUmVzdWx0c0V2ZW50XG4gID4ge1xuICAgIGNvbnN0IHNlYXJjaFJlc3VsdHMkID0gdGhpcy5wcm9kdWN0U2VhcmNoU2VydmljZS5nZXRSZXN1bHRzKCkucGlwZShcbiAgICAgIC8vIHNraXBwaW5nIHRoZSBpbml0aWFsIHZhbHVlLCBhbmQgcHJldmVudGluZyBlbWlzc2lvbiBvZiB0aGUgcHJldmlvdXMgc2VhcmNoIHN0YXRlXG4gICAgICBza2lwKDEpXG4gICAgKTtcblxuICAgIGNvbnN0IGNhdGVnb3J5UGFnZVZpc2l0ZWRFdmVudCQgPSB0aGlzLmV2ZW50U2VydmljZVxuICAgICAgLmdldChQYWdlVmlzaXRlZEV2ZW50KVxuICAgICAgLnBpcGUoXG4gICAgICAgIG1hcCgocGFnZVZpc2l0ZWRFdmVudCkgPT4gKHtcbiAgICAgICAgICBpc0NhdGVnb3J5UGFnZTogcGFnZVZpc2l0ZWRFdmVudC5zZW1hbnRpY1JvdXRlID09PSAnY2F0ZWdvcnknLFxuICAgICAgICAgIGNhdGVnb3J5Q29kZTogcGFnZVZpc2l0ZWRFdmVudC5jb250ZXh0LmlkLFxuICAgICAgICB9KSlcbiAgICAgICk7XG5cbiAgICByZXR1cm4gY2F0ZWdvcnlQYWdlVmlzaXRlZEV2ZW50JC5waXBlKFxuICAgICAgc3dpdGNoTWFwKChwYWdlRXZlbnQpID0+IHtcbiAgICAgICAgaWYgKCFwYWdlRXZlbnQuaXNDYXRlZ29yeVBhZ2UpIHtcbiAgICAgICAgICByZXR1cm4gRU1QVFk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gc2VhcmNoUmVzdWx0cyQucGlwZShcbiAgICAgICAgICBtYXAoKHNlYXJjaFJlc3VsdHMpID0+ICh7XG4gICAgICAgICAgICBjYXRlZ29yeUNvZGU6IHBhZ2VFdmVudC5jYXRlZ29yeUNvZGUsXG4gICAgICAgICAgICBjYXRlZ29yeU5hbWU6IHNlYXJjaFJlc3VsdHMuYnJlYWRjcnVtYnNbMF0uZmFjZXRWYWx1ZU5hbWUsXG4gICAgICAgICAgfSkpLFxuICAgICAgICAgIG1hcCgoY2F0ZWdvcnlQYWdlKSA9PlxuICAgICAgICAgICAgY3JlYXRlRnJvbShDYXRlZ29yeVBhZ2VSZXN1bHRzRXZlbnQsIGNhdGVnb3J5UGFnZSlcbiAgICAgICAgICApXG4gICAgICAgICk7XG4gICAgICB9KVxuICAgICk7XG4gIH1cblxuICBwcm90ZWN0ZWQgYnVpbGRTZWFyY2hQYWdlUmVzdWx0c0V2ZW50KCk6IE9ic2VydmFibGU8U2VhcmNoUGFnZVJlc3VsdHNFdmVudD4ge1xuICAgIGNvbnN0IHNlYXJjaFJlc3VsdHMkID0gdGhpcy5wcm9kdWN0U2VhcmNoU2VydmljZS5nZXRSZXN1bHRzKCkucGlwZShcbiAgICAgIC8vIHNraXBwaW5nIHRoZSBpbml0aWFsIHZhbHVlLCBhbmQgcHJldmVudGluZyBlbWlzc2lvbiBvZiB0aGUgcHJldmlvdXMgc2VhcmNoIHN0YXRlXG4gICAgICBza2lwKDEpLFxuICAgICAgbWFwKChzZWFyY2hSZXN1bHRzKSA9PiAoe1xuICAgICAgICBzZWFyY2hUZXJtOiBzZWFyY2hSZXN1bHRzLmZyZWVUZXh0U2VhcmNoLFxuICAgICAgICBudW1iZXJPZlJlc3VsdHM6IHNlYXJjaFJlc3VsdHMucGFnaW5hdGlvbi50b3RhbFJlc3VsdHMsXG4gICAgICB9KSksXG4gICAgICBtYXAoKHNlYXJjaFBhZ2UpID0+IGNyZWF0ZUZyb20oU2VhcmNoUGFnZVJlc3VsdHNFdmVudCwgc2VhcmNoUGFnZSkpXG4gICAgKTtcblxuICAgIGNvbnN0IHNlYXJjaFBhZ2VWaXNpdGVkRXZlbnQkID0gdGhpcy5ldmVudFNlcnZpY2VcbiAgICAgIC5nZXQoUGFnZVZpc2l0ZWRFdmVudClcbiAgICAgIC5waXBlKFxuICAgICAgICBtYXAoKHBhZ2VWaXNpdGVkRXZlbnQpID0+IHBhZ2VWaXNpdGVkRXZlbnQuc2VtYW50aWNSb3V0ZSA9PT0gJ3NlYXJjaCcpXG4gICAgICApO1xuXG4gICAgcmV0dXJuIHNlYXJjaFBhZ2VWaXNpdGVkRXZlbnQkLnBpcGUoXG4gICAgICBzd2l0Y2hNYXAoKGlzU2VhcmNoUGFnZSkgPT4gKGlzU2VhcmNoUGFnZSA/IHNlYXJjaFJlc3VsdHMkIDogRU1QVFkpKVxuICAgICk7XG4gIH1cbn1cbiJdfQ==