import { ChangeDetectionStrategy, Component, } from '@angular/core';
import { CheckoutService, DaysOfWeek, ORDER_TYPE, recurrencePeriod, } from '@spartacus/core';
import { Subscription } from 'rxjs';
import { ICON_TYPE } from '../../../misc/icon/icon.model';
import { CheckoutReplenishmentFormService } from '../../services/checkout-replenishment-form-service';
export class ScheduleReplenishmentOrderComponent {
    constructor(checkoutService, checkoutReplenishmentFormService) {
        this.checkoutService = checkoutService;
        this.checkoutReplenishmentFormService = checkoutReplenishmentFormService;
        this.subscription = new Subscription();
        this.iconTypes = ICON_TYPE;
        this.orderTypes = ORDER_TYPE;
        this.daysOfWeek = Object.keys(DaysOfWeek).map((key) => DaysOfWeek[key]);
        this.recurrencePeriodType = Object.keys(recurrencePeriod).map((key) => recurrencePeriod[key]);
        this.selectedOrderType$ = this.checkoutService.getCurrentOrderType();
        this.isMonthly = false;
        this.isWeekly = false;
        this.currentDaysOfWeek = [];
    }
    ngOnInit() {
        this.subscription.add(this.checkoutReplenishmentFormService
            .getScheduleReplenishmentFormData()
            .subscribe((data) => {
            this.scheduleReplenishmentFormData = data;
        }));
        this.initConfig();
    }
    changeOrderType(orderType) {
        this.checkoutService.setOrderType(orderType);
    }
    changeNumberOfDays(nDays) {
        this.checkoutReplenishmentFormService.setScheduleReplenishmentFormData(Object.assign(Object.assign({}, this.scheduleReplenishmentFormData), { numberOfDays: nDays }));
    }
    changeNumberOfWeeks(nWeeks) {
        this.checkoutReplenishmentFormService.setScheduleReplenishmentFormData(Object.assign(Object.assign({}, this.scheduleReplenishmentFormData), { numberOfWeeks: nWeeks }));
    }
    changeRecurrencePeriodType(type) {
        this.isWeekly = type === recurrencePeriod.WEEKLY;
        this.isMonthly = type === recurrencePeriod.MONTHLY;
        this.numberOfDays = this.isMonthly
            ? this.createNumberStringArray(31)
            : this.createNumberStringArray(30);
        this.checkoutReplenishmentFormService.setScheduleReplenishmentFormData(Object.assign(Object.assign({}, this.scheduleReplenishmentFormData), { recurrencePeriod: type }));
    }
    changeDayOfTheMonth(dayOfMonth) {
        this.checkoutReplenishmentFormService.setScheduleReplenishmentFormData(Object.assign(Object.assign({}, this.scheduleReplenishmentFormData), { nthDayOfMonth: dayOfMonth }));
    }
    changeReplenishmentStartDate(date) {
        if (Boolean(date)) {
            this.checkoutReplenishmentFormService.setScheduleReplenishmentFormData(Object.assign(Object.assign({}, this.scheduleReplenishmentFormData), { replenishmentStartDate: date }));
        }
    }
    changeRepeatDays(day, isChecked) {
        if (isChecked) {
            this.currentDaysOfWeek = [...this.currentDaysOfWeek];
            this.currentDaysOfWeek.push(day);
            this.checkoutReplenishmentFormService.setScheduleReplenishmentFormData(Object.assign(Object.assign({}, this.scheduleReplenishmentFormData), { daysOfWeek: this.currentDaysOfWeek }));
        }
        else {
            const foundDay = this.currentDaysOfWeek.find((data) => day === data);
            if (!foundDay)
                return;
            const index = this.currentDaysOfWeek.indexOf(foundDay);
            this.currentDaysOfWeek.splice(index, 1);
            this.checkoutReplenishmentFormService.setScheduleReplenishmentFormData(Object.assign(Object.assign({}, this.scheduleReplenishmentFormData), { daysOfWeek: this.currentDaysOfWeek }));
        }
    }
    hasDaysOfWeekChecked(day) {
        return this.currentDaysOfWeek.includes(day);
    }
    initConfig() {
        this.isMonthly =
            this.scheduleReplenishmentFormData.recurrencePeriod ===
                recurrencePeriod.MONTHLY;
        this.isWeekly =
            this.scheduleReplenishmentFormData.recurrencePeriod ===
                recurrencePeriod.WEEKLY;
        this.currentDaysOfWeek = [...this.scheduleReplenishmentFormData.daysOfWeek];
        this.numberOfDays = this.isMonthly
            ? this.createNumberStringArray(31)
            : this.createNumberStringArray(30);
        this.numberOfWeeks = this.createNumberStringArray(12);
        this.currentDate = this.scheduleReplenishmentFormData.replenishmentStartDate;
    }
    createNumberStringArray(n) {
        return Array(n)
            .fill(0)
            .map((_, y) => (y + 1).toString());
    }
    ngOnDestroy() {
        this.subscription.unsubscribe();
    }
}
ScheduleReplenishmentOrderComponent.decorators = [
    { type: Component, args: [{
                selector: 'cx-schedule-replenishment-order',
                template: "<div class=\"cx-order-type-card\">\n  <div class=\"cx-label-container\">\n    <h5 class=\"cx-order-replenishment-header\">\n      {{ 'checkoutReview.autoReplenishOrder' | cxTranslate }}\n    </h5>\n    <cx-icon [type]=\"iconTypes.CLOCK\"></cx-icon>\n  </div>\n  <div\n    class=\"cx-order-type-container form-check\"\n    *ngFor=\"let type of orderTypes | keyvalue\"\n  >\n    <input\n      id=\"orderType-{{ type.value }}\"\n      class=\"scaled-input form-check-input\"\n      role=\"radio\"\n      type=\"radio\"\n      formControlName=\"orderType\"\n      aria-checked=\"true\"\n      (change)=\"changeOrderType(type.value)\"\n      [value]=\"type.value\"\n      [checked]=\"type.value == (selectedOrderType$ | async)\"\n    />\n    <label\n      class=\"order-type-label form-check-label form-radio-label\"\n      for=\"orderType-{{ type.value }}\"\n    >\n      <div class=\"order-type\">\n        {{ 'checkoutReview.orderType' | cxTranslate: { context: type.value } }}\n      </div>\n    </label>\n  </div>\n  <ng-container\n    *ngIf=\"\n      scheduleReplenishmentFormData &&\n      (selectedOrderType$ | async) === orderTypes.SCHEDULE_REPLENISHMENT_ORDER\n    \"\n  >\n    <div class=\"cx-replenishment-form-data-container\">\n      <div *ngIf=\"!isMonthly\" class=\"cx-days\">\n        <span class=\"form-data-label\">{{\n          'checkoutReview.every' | cxTranslate\n        }}</span>\n        <ng-container *ngIf=\"isWeekly; else isDaily\">\n          <select\n            class=\"form-control\"\n            (change)=\"changeNumberOfWeeks($event.target.value)\"\n          >\n            <option\n              *ngFor=\"let nWeeks of numberOfWeeks\"\n              [value]=\"nWeeks\"\n              [selected]=\"\n                nWeeks === scheduleReplenishmentFormData.numberOfWeeks\n              \"\n            >\n              {{ nWeeks }}\n            </option>\n          </select>\n        </ng-container>\n        <ng-template #isDaily>\n          <select\n            class=\"form-control\"\n            (change)=\"changeNumberOfDays($event.target.value)\"\n          >\n            <option\n              *ngFor=\"let nDays of numberOfDays\"\n              [value]=\"nDays\"\n              [selected]=\"nDays === scheduleReplenishmentFormData.numberOfDays\"\n            >\n              {{ nDays }}\n            </option>\n          </select>\n        </ng-template>\n      </div>\n      <div class=\"cx-month\">\n        <span *ngIf=\"isMonthly\" class=\"form-data-label\">{{\n          'checkoutReview.every' | cxTranslate\n        }}</span>\n        <select\n          class=\"form-control\"\n          (change)=\"changeRecurrencePeriodType($event.target.value)\"\n        >\n          <option\n            *ngFor=\"let type of recurrencePeriodType\"\n            [value]=\"type\"\n            [selected]=\"type === scheduleReplenishmentFormData.recurrencePeriod\"\n          >\n            {{\n              'checkoutReview.recurrencePeriodType'\n                | cxTranslate: { context: type }\n            }}\n          </option>\n        </select>\n      </div>\n      <div *ngIf=\"isMonthly\" class=\"cx-dayMonth\">\n        <span class=\"form-data-label\">{{\n          'checkoutReview.dayOfMonth' | cxTranslate\n        }}</span>\n        <div class=\"cx-day-of-month\">\n          <select\n            class=\"form-control\"\n            (change)=\"changeDayOfTheMonth($event.target.value)\"\n          >\n            <option\n              *ngFor=\"let nDays of numberOfDays\"\n              [value]=\"nDays\"\n              [selected]=\"nDays === scheduleReplenishmentFormData.nthDayOfMonth\"\n            >\n              {{ nDays }}\n            </option>\n          </select>\n        </div>\n      </div>\n    </div>\n\n    <div class=\"cx-replenishment-form-data-container\">\n      <span class=\"form-data-label\">{{\n        'checkoutReview.startOn' | cxTranslate\n      }}</span>\n      <div class=\"cx-replenishment-date\">\n        <input\n          type=\"date\"\n          placeholder=\"yyyy-mm-dd\"\n          [value]=\"currentDate\"\n          (change)=\"changeReplenishmentStartDate($event.target.value)\"\n        />\n      </div>\n    </div>\n\n    <div\n      *ngIf=\"isWeekly\"\n      class=\"cx-replenishment-form-data-container cx-repeat-days-container\"\n    >\n      <span class=\"cx-repeat-days form-data-label\">{{\n        'checkoutReview.repeatOnDays' | cxTranslate\n      }}</span>\n      <div *ngFor=\"let day of daysOfWeek\" class=\"form-check\">\n        <label for=\"day-{{ day }}\" class=\"cx-week-day\">{{\n          day | titlecase\n        }}</label\n        ><input\n          id=\"day-{{ day }}\"\n          type=\"checkbox\"\n          class=\"form-check-input\"\n          [checked]=\"hasDaysOfWeekChecked(day)\"\n          (change)=\"changeRepeatDays(day, $event.target.checked)\"\n        />\n      </div>\n    </div>\n  </ng-container>\n</div>\n",
                changeDetection: ChangeDetectionStrategy.OnPush
            },] }
];
ScheduleReplenishmentOrderComponent.ctorParameters = () => [
    { type: CheckoutService },
    { type: CheckoutReplenishmentFormService }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NoZWR1bGUtcmVwbGVuaXNobWVudC1vcmRlci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9zdG9yZWZyb250bGliL3NyYy9jbXMtY29tcG9uZW50cy9jaGVja291dC9jb21wb25lbnRzL3NjaGVkdWxlLXJlcGxlbmlzaG1lbnQtb3JkZXIvc2NoZWR1bGUtcmVwbGVuaXNobWVudC1vcmRlci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNMLHVCQUF1QixFQUN2QixTQUFTLEdBR1YsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUNMLGVBQWUsRUFDZixVQUFVLEVBQ1YsVUFBVSxFQUNWLGdCQUFnQixHQUVqQixNQUFNLGlCQUFpQixDQUFDO0FBQ3pCLE9BQU8sRUFBYyxZQUFZLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDaEQsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLCtCQUErQixDQUFDO0FBQzFELE9BQU8sRUFBRSxnQ0FBZ0MsRUFBRSxNQUFNLG9EQUFvRCxDQUFDO0FBT3RHLE1BQU0sT0FBTyxtQ0FBbUM7SUFzQjlDLFlBQ1ksZUFBZ0MsRUFDaEMsZ0NBQWtFO1FBRGxFLG9CQUFlLEdBQWYsZUFBZSxDQUFpQjtRQUNoQyxxQ0FBZ0MsR0FBaEMsZ0NBQWdDLENBQWtDO1FBdkJ0RSxpQkFBWSxHQUFpQixJQUFJLFlBQVksRUFBRSxDQUFDO1FBRXhELGNBQVMsR0FBRyxTQUFTLENBQUM7UUFDdEIsZUFBVSxHQUFHLFVBQVUsQ0FBQztRQUN4QixlQUFVLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ25FLHlCQUFvQixHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMs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NkIsQ0FBQyxzQkFBc0IsQ0FBQztJQUMvRSxDQUFDO0lBRU8sdUJBQXVCLENBQUMsQ0FBUztRQUN2QyxPQUFPLEtBQUssQ0FBQyxDQUFDLENBQUM7YUFDWixJQUFJLENBQUMsQ0FBQyxDQUFDO2FBQ1AsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQztJQUN2QyxDQUFDO0lBRUQsV0FBVztRQUNULElBQUksQ0FBQyxZQUFZLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDbEMsQ0FBQzs7O1lBckpGLFNBQVMsU0FBQztnQkFDVCxRQUFRLEVBQUUsaUNBQWlDO2dCQUMzQywrMEpBQTREO2dCQUM1RCxlQUFlLEVBQUUsdUJBQXVCLENBQUMsTUFBTTthQUNoRDs7O1lBZEMsZUFBZTtZQVFSLGdDQUFnQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICBDb21wb25lbnQsXG4gIE9uRGVzdHJveSxcbiAgT25Jbml0LFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7XG4gIENoZWNrb3V0U2VydmljZSxcbiAgRGF5c09mV2VlayxcbiAgT1JERVJfVFlQRSxcbiAgcmVjdXJyZW5jZVBlcmlvZCxcbiAgU2NoZWR1bGVSZXBsZW5pc2htZW50Rm9ybSxcbn0gZnJvbSAnQHNwYXJ0YWN1cy9jb3JlJztcbmltcG9ydCB7IE9ic2VydmFibGUsIFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgSUNPTl9UWVBFIH0gZnJvbSAnLi4vLi4vLi4vbWlzYy9pY29uL2ljb24ubW9kZWwnO1xuaW1wb3J0IHsgQ2hlY2tvdXRSZXBsZW5pc2htZW50Rm9ybVNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9jaGVja291dC1yZXBsZW5pc2htZW50LWZvcm0tc2VydmljZSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2N4LXNjaGVkdWxlLXJlcGxlbmlzaG1lbnQtb3JkZXInLFxuICB0ZW1wbGF0ZVVybDogJy4vc2NoZWR1bGUtcmVwbGVuaXNobWVudC1vcmRlci5jb21wb25lbnQuaHRtbCcsXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxufSlcbmV4cG9ydCBjbGFzcyBTY2hlZHVsZVJlcGxlbmlzaG1lbnRPcmRlckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95IHtcbiAgcHJpdmF0ZSBzdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbiA9IG5ldyBTdWJzY3JpcHRpb24oKTtcblxuICBpY29uVHlwZXMgPSBJQ09OX1RZUEU7XG4gIG9yZGVyVHlwZXMgPSBPUkRFUl9UWVBFO1xuICBkYXlzT2ZXZWVrID0gT2JqZWN0LmtleXMoRGF5c09mV2VlaykubWFwKChrZXkpID0+IERheXNPZldlZWtba2V5XSk7XG4gIHJlY3VycmVuY2VQZXJpb2RUeXBlID0gT2JqZWN0LmtleXMocmVjdXJyZW5jZVBlcmlvZCkubWFwKFxuICAgIChrZXkpID0+IHJlY3VycmVuY2VQZXJpb2Rba2V5XVxuICApO1xuXG4gIHNlbGVjdGVkT3JkZXJUeXBlJDogT2JzZXJ2YWJsZTxcbiAgICBPUkRFUl9UWVBFXG4gID4gPSB0aGlzLmNoZWNrb3V0U2VydmljZS5nZXRDdXJyZW50T3JkZXJUeXBlKCk7XG5cbiAgaXNNb250aGx5OiBCb29sZWFuID0gZmFsc2U7XG4gIGlzV2Vla2x5OiBCb29sZWFuID0gZmFsc2U7XG4gIGN1cnJlbnREYXlzT2ZXZWVrOiBEYXlzT2ZXZWVrW10gPSBbXTtcbiAgbnVtYmVyT2ZEYXlzOiBzdHJpbmdbXTtcbiAgbnVtYmVyT2ZXZWVrczogc3RyaW5nW107XG4gIGN1cnJlbnREYXRlOiBzdHJpbmc7XG4gIHNjaGVkdWxlUmVwbGVuaXNobWVudEZvcm1EYXRhOiBTY2hlZHVsZVJlcGxlbmlzaG1lbnRGb3JtO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByb3RlY3RlZCBjaGVja291dFNlcnZpY2U6IENoZWNrb3V0U2VydmljZSxcbiAgICBwcm90ZWN0ZWQgY2hlY2tvdXRSZXBsZW5pc2htZW50Rm9ybVNlcnZpY2U6IENoZWNrb3V0UmVwbGVuaXNobWVudEZvcm1TZXJ2aWNlXG4gICkge31cblxuICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLnN1YnNjcmlwdGlvbi5hZGQoXG4gICAgICB0aGlzLmNoZWNrb3V0UmVwbGVuaXNobWVudEZvcm1TZXJ2aWNlXG4gICAgICAgIC5nZXRTY2hlZHVsZVJlcGxlbmlzaG1lbnRGb3JtRGF0YSgpXG4gICAgICAgIC5zdWJzY3JpYmUoKGRhdGEpID0+IHtcbiAgICAgICAgICB0aGlzLnNjaGVkdWxlUmVwbGVuaXNobWVudEZvcm1EYXRhID0gZGF0YTtcbiAgICAgICAgfSlcbiAgICApO1xuXG4gICAgdGhpcy5pbml0Q29uZmlnKCk7XG4gIH1cblxuICBjaGFuZ2VPcmRlclR5cGUob3JkZXJUeXBlOiBPUkRFUl9UWVBFKTogdm9pZCB7XG4gICAgdGhpcy5jaGVja291dFNlcnZpY2Uuc2V0T3JkZXJUeXBlKG9yZGVyVHlwZSk7XG4gIH1cblxuICBjaGFuZ2VOdW1iZXJPZkRheXMobkRheXM6IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMuY2hlY2tvdXRSZXBsZW5pc2htZW50Rm9ybVNlcnZpY2Uuc2V0U2NoZWR1bGVSZXBsZW5pc2htZW50Rm9ybURhdGEoe1xuICAgICAgLi4udGhpcy5zY2hlZHVsZVJlcGxlbmlzaG1lbnRGb3JtRGF0YSxcbiAgICAgIG51bWJlck9mRGF5czogbkRheXMsXG4gICAgfSk7XG4gIH1cblxuICBjaGFuZ2VOdW1iZXJPZldlZWtzKG5XZWVrczogc3RyaW5nKTogdm9pZCB7XG4gICAgdGhpcy5jaGVja291dFJlcGxlbmlzaG1lbnRGb3JtU2VydmljZS5zZXRTY2hlZHVsZVJlcGxlbmlzaG1lbnRGb3JtRGF0YSh7XG4gICAgICAuLi50aGlzLnNjaGVkdWxlUmVwbGVuaXNobWVudEZvcm1EYXRhLFxuICAgICAgbnVtYmVyT2ZXZWVrczogbldlZWtzLFxuICAgIH0pO1xuICB9XG5cbiAgY2hhbmdlUmVjdXJyZW5jZVBlcmlvZFR5cGUodHlwZTogc3RyaW5nKTogdm9pZCB7XG4gICAgdGhpcy5pc1dlZWtseSA9IHR5cGUgPT09IHJlY3VycmVuY2VQZXJpb2QuV0VFS0xZO1xuICAgIHRoaXMuaXNNb250aGx5ID0gdHlwZSA9PT0gcmVjdXJyZW5jZVBlcmlvZC5NT05USExZO1xuXG4gICAgdGhpcy5udW1iZXJPZkRheXMgPSB0aGlzLmlzTW9udGhseVxuICAgICAgPyB0aGlzLmNyZWF0ZU51bWJlclN0cmluZ0FycmF5KDMxKVxuICAgICAgOiB0aGlzLmNyZWF0ZU51bWJlclN0cmluZ0FycmF5KDMwKTtcblxuICAgIHRoaXMuY2hlY2tvdXRSZXBsZW5pc2htZW50Rm9ybVNlcnZpY2Uuc2V0U2NoZWR1bGVSZXBsZW5pc2htZW50Rm9ybURhdGEoe1xuICAgICAgLi4udGhpcy5zY2hlZHVsZVJlcGxlbmlzaG1lbnRGb3JtRGF0YSxcbiAgICAgIHJlY3VycmVuY2VQZXJpb2Q6IHR5cGUsXG4gICAgfSk7XG4gIH1cblxuICBjaGFuZ2VEYXlPZlRoZU1vbnRoKGRheU9mTW9udGg6IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMuY2hlY2tvdXRSZXBsZW5pc2htZW50Rm9ybVNlcnZpY2Uuc2V0U2NoZWR1bGVSZXBsZW5pc2htZW50Rm9ybURhdGEoe1xuICAgICAgLi4udGhpcy5zY2hlZHVsZVJlcGxlbmlzaG1lbnRGb3JtRGF0YSxcbiAgICAgIG50aERheU9mTW9udGg6IGRheU9mTW9udGgsXG4gICAgfSk7XG4gIH1cblxuICBjaGFuZ2VSZXBsZW5pc2htZW50U3RhcnREYXRlKGRhdGU6IHN0cmluZyk6IHZvaWQge1xuICAgIGlmIChCb29sZWFuKGRhdGUpKSB7XG4gICAgICB0aGlzLmNoZWNrb3V0UmVwbGVuaXNobWVudEZvcm1TZXJ2aWNlLnNldFNjaGVkdWxlUmVwbGVuaXNobWVudEZvcm1EYXRhKHtcbiAgICAgICAgLi4udGhpcy5zY2hlZHVsZVJlcGxlbmlzaG1lbnRGb3JtRGF0YSxcbiAgICAgICAgcmVwbGVuaXNobWVudFN0YXJ0RGF0ZTogZGF0ZSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIGNoYW5nZVJlcGVhdERheXMoZGF5OiBEYXlzT2ZXZWVrLCBpc0NoZWNrZWQ6IGJvb2xlYW4pOiB2b2lkIHtcbiAgICBpZiAoaXNDaGVja2VkKSB7XG4gICAgICB0aGlzLmN1cnJlbnREYXlzT2ZXZWVrID0gWy4uLnRoaXMuY3VycmVudERheXNPZldlZWtdO1xuXG4gICAgICB0aGlzLmN1cnJlbnREYXlzT2ZXZWVrLnB1c2goZGF5KTtcblxuICAgICAgdGhpcy5jaGVja291dFJlcGxlbmlzaG1lbnRGb3JtU2VydmljZS5zZXRTY2hlZHVsZVJlcGxlbmlzaG1lbnRGb3JtRGF0YSh7XG4gICAgICAgIC4uLnRoaXMuc2NoZWR1bGVSZXBsZW5pc2htZW50Rm9ybURhdGEsXG4gICAgICAgIGRheXNPZldlZWs6IHRoaXMuY3VycmVudERheXNPZldlZWssXG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgZm91bmREYXkgPSB0aGlzLmN1cnJlbnREYXlzT2ZXZWVrLmZpbmQoKGRhdGEpID0+IGRheSA9PT0gZGF0YSk7XG5cbiAgICAgIGlmICghZm91bmREYXkpIHJldHVybjtcblxuICAgICAgY29uc3QgaW5kZXggPSB0aGlzLmN1cnJlbnREYXlzT2ZXZWVrLmluZGV4T2YoZm91bmREYXkpO1xuICAgICAgdGhpcy5jdXJyZW50RGF5c09mV2Vlay5zcGxpY2UoaW5kZXgsIDEpO1xuXG4gICAgICB0aGlzLmNoZWNrb3V0UmVwbGVuaXNobWVudEZvcm1TZXJ2aWNlLnNldFNjaGVkdWxlUmVwbGVuaXNobWVudEZvcm1EYXRhKHtcbiAgICAgICAgLi4udGhpcy5zY2hlZHVsZVJlcGxlbmlzaG1lbnRGb3JtRGF0YSxcbiAgICAgICAgZGF5c09mV2VlazogdGhpcy5jdXJyZW50RGF5c09mV2VlayxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIGhhc0RheXNPZldlZWtDaGVja2VkKGRheTogRGF5c09mV2Vlayk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmN1cnJlbnREYXlzT2ZXZWVrLmluY2x1ZGVzKGRheSk7XG4gIH1cblxuICBwcml2YXRlIGluaXRDb25maWcoKTogdm9pZCB7XG4gICAgdGhpcy5pc01vbnRobHkgPVxuICAgICAgdGhpcy5zY2hlZHVsZVJlcGxlbmlzaG1lbnRGb3JtRGF0YS5yZWN1cnJlbmNlUGVyaW9kID09PVxuICAgICAgcmVjdXJyZW5jZVBlcmlvZC5NT05USExZO1xuXG4gICAgdGhpcy5pc1dlZWtseSA9XG4gICAgICB0aGlzLnNjaGVkdWxlUmVwbGVuaXNobWVudEZvcm1EYXRhLnJlY3VycmVuY2VQZXJpb2QgPT09XG4gICAgICByZWN1cnJlbmNlUGVyaW9kLldFRUtMWTtcblxuICAgIHRoaXMuY3VycmVudERheXNPZldlZWsgPSBbLi4udGhpcy5zY2hlZHVsZVJlcGxlbmlzaG1lbnRGb3JtRGF0YS5kYXlzT2ZXZWVrXTtcblxuICAgIHRoaXMubnVtYmVyT2ZEYXlzID0gdGhpcy5pc01vbnRobHlcbiAgICAgID8gdGhpcy5jcmVhdGVOdW1iZXJTdHJpbmdBcnJheSgzMSlcbiAgICAgIDogdGhpcy5jcmVhdGVOdW1iZXJTdHJpbmdBcnJheSgzMCk7XG5cbiAgICB0aGlzLm51bWJlck9mV2Vla3MgPSB0aGlzLmNyZWF0ZU51bWJlclN0cmluZ0FycmF5KDEyKTtcblxuICAgIHRoaXMuY3VycmVudERhdGUgPSB0aGlzLnNjaGVkdWxlUmVwbGVuaXNobWVudEZvcm1EYXRhLnJlcGxlbmlzaG1lbnRTdGFydERhdGU7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZU51bWJlclN0cmluZ0FycmF5KG46IG51bWJlcik6IHN0cmluZ1tdIHtcbiAgICByZXR1cm4gQXJyYXkobilcbiAgICAgIC5maWxsKDApXG4gICAgICAubWFwKChfLCB5KSA9PiAoeSArIDEpLnRvU3RyaW5nKCkpO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgdGhpcy5zdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgfVxufVxuIl19